<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Seed Accounts</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
    button { padding: 10px 14px; cursor: pointer; }
    button[disabled] { cursor: not-allowed; opacity: 0.6; }
    pre { background: #f6f8fa; padding: 12px; border-radius: 8px; overflow:auto; }
  </style>
</head>
<body>
  <h1>ğŸŒ± Demo ê³„ì • 50ê°œ ì‹œë“œ</h1>
  <p>ì•„ë˜ ë²„íŠ¼ì€ <b>ë”± í•œ ë²ˆë§Œ</b> ëˆ„ë¥´ì„¸ìš”. ì™„ë£Œë˜ë©´ ì´ í˜ì´ì§€(seed.html)ëŠ” ì‚­ì œ/ë¹„í™œì„±í™” ê¶Œì¥.</p>

  <button id="seed">ğŸ”¥ Seed 50 Accounts</button>
  <button id="verify" style="margin-left:8px;">ğŸ” Verify (ëª‡ ê°œ ìˆëŠ”ì§€ í™•ì¸)</button>
  <button id="reset" style="margin-left:8px;">â™»ï¸ Reset Reserved (ì „ì²´ ì´ˆê¸°í™”)</button>

  <h3>ë¡œê·¸</h3>
  <pre id="log">ëŒ€ê¸° ì¤‘...</pre>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      collection,
      getDocs,
      query,
      orderBy,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // âœ… index.htmlì—ì„œ ì‚¬ìš©í•œ configì™€ ë™ì¼í•˜ê²Œ ë„£ê¸°
    const firebaseConfig = {
      apiKey: "AIzaSyAtMRjuzCZGDnsn-TfPuZjDOs86Ey--ARk",
      authDomain: "accounts-b74f0.firebaseapp.com",
      projectId: "accounts-b74f0",
      storageBucket: "accounts-b74f0.firebasestorage.app",
      messagingSenderId: "729059899668",
      appId: "1:729059899668:web:f18eee7aa1ee6d15ae6a01"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const logEl = document.getElementById("log");
    const seedBtn = document.getElementById("seed");
    const verifyBtn = document.getElementById("verify");
    const resetBtn = document.getElementById("reset");

    function pad2(n){ return String(n).padStart(2,'0'); }
    function log(line){ logEl.textContent += `\n${line}`; }

    async function ensureAnonLogin() {
      await signInAnonymously(auth);
    }

    seedBtn.onclick = async () => {
      seedBtn.disabled = true;
      verifyBtn.disabled = true;
      resetBtn.disabled = true;

      logEl.textContent = "ë¡œê·¸ì¸(ìµëª…) ì¤‘...";
      try {
        await ensureAnonLogin();
        log("âœ… ìµëª… ë¡œê·¸ì¸ ì™„ë£Œ");

        log("ğŸš€ accounts/01 ~ accounts/50 ìƒì„± ì‹œì‘...");

        // âš ï¸ ë¹„ë°€ë²ˆí˜¸ ì €ì¥ì€ ë¹„ì¶”ì²œ. ì •ë§ ë„£ê³  ì‹¶ìœ¼ë©´ password í•„ë“œ ì£¼ì„ í•´ì œ.
        for (let i = 1; i <= 50; i++) {
          const id2 = pad2(i);
          await setDoc(doc(db, "accounts", id2), {
            id: i,
            email: `demo${id2}@miee.dev`,
            // password: "Elevate!",
            status: "available",
            reservedBy: null,
            reservedAt: null
          }, { merge: true });

          log(`âœ… created/updated: accounts/${id2}`);
        }

        log("ğŸ‰ ì™„ë£Œ! Firestoreì— 50ê°œ ê³„ì •ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.");
        log("ğŸ‘‰ ì´ì œ index.html í˜ì´ì§€ë¡œ ê°€ì„œ ì‹¤ì‹œê°„ ì²´í¬ í…ŒìŠ¤íŠ¸ í•˜ì„¸ìš”.");
        log("âš ï¸ ë³´ì•ˆìƒ seed.htmlì€ ë°”ë¡œ ì‚­ì œ/ë¹„í™œì„±í™” ê¶Œì¥!");
      } catch (e) {
        log(`âŒ ì˜¤ë¥˜: ${e.message || String(e)}`);
      } finally {
        seedBtn.disabled = false;
        verifyBtn.disabled = false;
        resetBtn.disabled = false;
      }
    };

    verifyBtn.onclick = async () => {
      seedBtn.disabled = true;
      verifyBtn.disabled = true;
      resetBtn.disabled = true;

      logEl.textContent = "ê²€ì¦(Verify) ì¤‘...";
      try {
        await ensureAnonLogin();

        const q = query(collection(db, "accounts"), orderBy("id"));
        const snap = await getDocs(q);

        log(`âœ… accounts ë¬¸ì„œ ìˆ˜: ${snap.size}`);

        if (snap.size > 0) {
          const first = snap.docs[0].data();
          const last = snap.docs[snap.docs.length - 1].data();
          log(`ì²« ë¬¸ì„œ ì˜ˆ: id=${first.id}, email=${first.email}, status=${first.status}`);
          log(`ë§ˆì§€ë§‰ ë¬¸ì„œ ì˜ˆ: id=${last.id}, email=${last.email}, status=${last.status}`);
        }
        log("ê²€ì¦ ì™„ë£Œ");
      } catch (e) {
        log(`âŒ ì˜¤ë¥˜: ${e.message || String(e)}`);
      } finally {
        seedBtn.disabled = false;
        verifyBtn.disabled = false;
        resetBtn.disabled = false;
      }
    };

    // âœ… Reset: reserved â†’ available ë¡œ ì „ì²´ ì´ˆê¸°í™”
    resetBtn.onclick = async () => {
      const ok = confirm("âš ï¸ ëª¨ë“  Reserved ê³„ì •ì„ Availableë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?\n(ReservedBy/ReservedAtë„ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.)");
      if (!ok) return;

      seedBtn.disabled = true;
      verifyBtn.disabled = true;
      resetBtn.disabled = true;

      logEl.textContent = "ì´ˆê¸°í™”(Reset) ì¤‘...";
      try {
        await ensureAnonLogin();
        log("âœ… ìµëª… ë¡œê·¸ì¸ ì™„ë£Œ");

        const q = query(collection(db, "accounts"), orderBy("id"));
        const snap = await getDocs(q);

        let changed = 0;

        for (const d of snap.docs) {
          const data = d.data();
          if (data.status === "reserved") {
            await updateDoc(doc(db, "accounts", d.id), {
              status: "available",
              reservedBy: null,
              reservedAt: null
            });
            changed++;
            log(`â™»ï¸ reset: accounts/${d.id}`);
          }
        }

        log(`ğŸ‰ ì´ˆê¸°í™” ì™„ë£Œ! reserved â†’ available: ${changed}ê°œ`);
        log("ğŸ‘‰ index.html í˜ì´ì§€ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°”ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.");
      } catch (e) {
        log(`âŒ ì˜¤ë¥˜: ${e.message || String(e)}`);
      } finally {
        seedBtn.disabled = false;
        verifyBtn.disabled = false;
        resetBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
